<!DOCTYPE html>
<html lang="en" data-ng-app="mightynestApp">
  <head>
    <script src="//cdn.optimizely.com/js/81842342.js"></script>
    <title>Mighty Schools Fundraising Program: Fund Your Mighty School</title>
    <link rel="stylesheet/less" href="components/bootstrap/less/bootstrap.less" media="all" />
    <link rel="stylesheet/less" href="css/style.less" media="all" />
    <script src="components/lessjs/less-1.3.3.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
    <script>
      var Drupal = {
        settings : {}
      };
      Drupal.settings.affiliate_create_module_path = '../';
      Drupal.settings.affiliate_create_json_file_path = 'sites/schools.mightynest.com/files/json';
    </script>
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/themes/base/jquery-ui.css" />
    <link href="css/school-list.css" media="all" rel="stylesheet" type="text/css" />
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.js"></script>
    <script src="/sites/all/modules/mightynest_custom/modules/uc_affiliate2_create/client-side/jquery.search.js"></script>
    <script src="components/bootstrap/js/bootstrap-tooltip.js"></script>
    <script src="components/bootstrap/js/bootstrap-popover.js"></script>
    <script src="components/bootstrap/js/bootstrap-modal.js"></script>

    <script src="components/js-yaml/js-yaml.min.js"></script>
    <script src="components/showdown/showdown.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.0.6/angular.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.0.6/angular-sanitize.min.js"></script>

    <script src="js/app.js"></script>
    <script src="js/config.js"></script>
    <script src="js/services/jsyml-helper-service.js"></script>
    <script src="js/controllers/faq.js"></script>
    <script src="js/controllers/headerContent.js"></script>

    <script type="text/javascript">
      <!--//--><![CDATA[//><!--
      var _gaq = _gaq || [];_gaq.push(["_setAccount", "UA-7833382-2"]);_gaq.push(["_trackPageview"]);(function() {var ga = document.createElement("script");ga.type = "text/javascript";ga.async = true;ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga, s);})();
      //--><!]]>
    </script>
  </head>
  <body>
    <div class="container">

      <div data-ng-include="'/views/header-content.html'"></div>

      <div id="content">
        <h2>Let us show you an example fundraiser created for your school.</h2>
        <form id="find-your-school" class="form-inline">
          <fieldset>
            <input id="target" type="text" placeholder="your zip code" class="span3" />
            <input id="school" type="text" placeholder="your school" class="span7" />
            <img title="remove school selection" src="/sites/all/modules/mightynest_custom/modules/uc_affiliate2_create/client-side/images/remove_school.gif" id="remove_select_school" style="display:nonel" />
            <button type="submit" id="school-submit-2" class="btn btn-danger" disabled="disabled">discover how</button>
          </fieldset>
        </form>
        <p class="add-school" style="display:none;"><a href="add-school.html">School not in the list?</a></p>
      </div>

      <div data-ng-include="'/views/faq.html'"></div>

      <div id="footer">
        <div class="contact">
          <h3>Contact Us</h3>
          <p>
            1-847-905-0567<br>
            Monday-Friday, 9 am - 5:30 pm CST<br>
            <a href="mailto:schools@mightynest.com" target="_blank">schools@mightynest.com</a><br>
          </p>
          <p class="copy">&copy;2013 MightyNest. All rights reversed.</p>
        </div>
        <div class="connect">
          <h3>Connect With Us:</h3>
          <a href="http://facebook.com/mightynest" class="fb"><img src="images/fb.jpg" alt="fb"/></a>
          <a href="http://twitter.com/mightynest" class="tw"><img src="images/twitter.jpg" alt="twitter"/></a>
        </div>
        <div class="share">
          <p>
            <a href="http://mightynest.com">Shop MightyNest.com</a>
          </p>
          <!-- AddThis Button BEGIN -->
          <a class="addthis_button shared btn btn-primary" href="http://www.addthis.com/bookmark.php?v=300&amp;pubid=mightynest">share this page with the PTA</a>
          <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
          <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=mightynest"></script>
          <!-- AddThis Button END -->
        </div>
      </div>
      <!-- Modal -->
      <div id="wufoo-Modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
          <h3 id="myModalLabel">Your Contact Information</h3>
        </div>
        <div class="modal-body" id="wufoo-z7x3p3">
          Fill out my <a href="http://mightynest.wufoo.com/forms/z7x3p3">online form</a>.
        </div>
        <div class="modal-footer">
          <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        </div>
      </div>
      <script type="text/javascript">
      var z7x3p3;(function(d, t) {
        var s = d.createElement(t);
        s.src = ('https:' == d.location.protocol ? 'https://' : 'http://') + 'wufoo.com/scripts/embed/form.js';
        s.onload = s.onreadystatechange = function() {
        var rs = this.readyState; if (rs) if (rs != 'complete') if (rs != 'loaded') return;
        };
        var scr = d.getElementsByTagName(t)[0], par = scr.parentNode; par.insertBefore(s, scr);
      })(document, 'script');
      </script>
    </div>
    <script>
      $(function() {
        // Open on button click
        $('#school-submit-2').bind('click', function (e) {
          e.preventDefault();
          // Trigger submit
          $('#find-your-school').submit();
          $('#school-submit-2').attr('disabled', 'disabled');
          $('#wufoo-Modal').modal();
          // Add Google Event
          _gaq.push(['_trackEvent', 'MS_learn_more', 'form submit', 'discover how']);
        });
        $('#wufoo-Modal').on('show', function() {
          // Init form
          z7x3p3 = new WufooForm();
          // Default value
          var school_info = $('#school').data('school'),
          options = {
            'userName':'mightynest',
            'formHash':'z7x3p3',
            'autoResize':true,
            'height':'360',
            'async':true,
            'header':'show'
          }, default_value = [];

          var mapping = {
            // school_name =  organization  = Field12
            'Field12': 'school_name',
            //  MS school_id  = Field20
            'Field20': 'school_id',
            //  MS Affiliate ID  = Field23
            'Field23': 'school_affiliate2_uid',
            // MS self-signup = 'more info',
            //'Field24': '',
            //mail_address  = Field25
            'Field25': 'mail_address',
            // mail_city = Field26
            'Field26': 'mail_city',
            // mail_state = Field27
            'Field27': 'mail_state',
            // mail_zip = Field28
            'Field28': 'mail_zip',
            // mail_zip4 = Field29
            'Field29': 'mail_zip4',
            //  school phone  = Field30
            'Field30': 'phone',
            //  MS School Size  = Field31
            'Field31': 'num_students',
            // MS Grade - start  = Field32
            'Field32': 'lowest_grade',
            //  MS Grade - end  = Field33
            'Field33': 'highest_grade',
            //  MS School Type  = Field34
            'Field34': 'source'
            //  MS Sign-up Date  = Field35
            //'Field35':
            //  MS Start Year  = Field36
            //'Field36':
            //  MS URL  = Field21
            //  Lead Source  = Field37
            //'Field37': 'mightynest.com',
            // Lead Medium  = Field38
            //'Field38': 'self-signup'
          };
          $.each(mapping, function (index, item) {
            default_value.push(index + '=' + encodeURI(school_info[item]));
          });
          // Some fixed field
          default_value.push('Field24=' + encodeURI('more info'));
          var d = new Date();
          var curr_date = d.getDate();
          var curr_month = d.getMonth() + 1;
          var curr_year = d.getFullYear();
          default_value.push('Field35=' + encodeURI(curr_month + '/' + curr_date + '/' + curr_year));
          default_value.push('Field36=' + encodeURI(curr_year));
          default_value.push('Field37=' + encodeURI('mightynest.com'));
          default_value.push('Field38=' + encodeURI('self-signup'));
          // Call to json server and get more info: aid + url
          $.ajax({
            async: false,
            url: '/affiliate/info/' + school_info.school_affiliate2_uid + '/json',
            dataType: 'json',
            success: function (data) {
              default_value.push('Field21=' + encodeURI(data.url));
            }
          });
          // Call to get username
          $.ajax({
            async: false,
            url: '/mightynest/user/json',
            dataType: 'json',
            success: function (data) {
              default_value.push('Field42=' + encodeURI(data.name));
            }
          });
          options.defaultValues = default_value.join('&');
          // Missing MS URL + MS Affiliate ID
          z7x3p3.initialize(options);
          z7x3p3.display();
          $('#wufoo-z7x3p3').trigger('resize');
        });
      });
      $('#target').school_complete({
        json_file: Drupal.settings.affiliate_create_json_file_path,
        update_element: 'school-id',
        affiliate_element: 'school-affiliate2-uid',
        input_element: 'school',
        submit_element: 'school-submit',
        select_element: 'school-select',
        affiliate_uid_element: 'school-affiliate2-uid',
        form_id: 'find-your-school',
        json_suffix: '.txt',
        has_affiliate: Drupal.settings.affiliate
      });
      // #42823885
      $('#school').on('autocompleteselect', function (event, ui) {
        // Check valid school
        if (typeof ui.item.value != 'undefined') {
          $('#school-submit-2').removeAttr('disabled');
          $('p.add-school').show();
          // Get zipcode entered
          var zipcode_entered = $('#target').val();
          _gaq.push(['_trackEvent', 'MS_cart_selector', 'form entry', zipcode_entered]);
          _gaq.push(['_trackEvent', 'MS_learn_more', 'form entry', zipcode_entered]);
        }
      });

        /* doLinks script */
        function linkify(inputText, options) {
          this.options = {linkClass: 'url', targetBlank: true};
          this.options = $.extend(this.options, options);
          inputText = inputText.replace(/\u200B/g, "");

          //URLs starting with http://, https://, or ftp://
          var replacePattern1 = /(src="|href="|">|\s>)?(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;ï]*[-A-Z0-9+&@#\/%=~_|ï]/gim;
          var replacedText = inputText.replace(replacePattern1, function($0,$1){ return $1?$0:'<a class="'+ this.options.linkClass + '" href="' + $0 + '"' + (this.options.targetBlank?'target="_blank"':'') + '>'+ $0+ '</a>';});

          //URLS starting with www and not the above
          var replacePattern2 = /(src="|href="|">|\s>|https?:\/\/|ftp:\/\/)?www\.[-A-Z0-9+&@#\/%?=~_|!:,.;ï]*[-A-Z0-9+&@#\/%=~_|ï]/gim;
          var replacedText = replacedText.replace(replacePattern2, function($0,$1){ return $1?$0:'<a class="'+ this.options.linkClass + '" href="http://' + $0 + '"' + (this.options.targetBlank?'target="_blank"':'') + '>'+ $0+ '</a>';});

          //Change email addresses to mailto:: links
          var replacePattern3 = /([\.\w]+@[a-zA-Z_]+?\.[a-zA-Z]{2,6})/gim;
          var replacedText = replacedText.replace(replacePattern3, '<a class="' + this.options.linkClass + '" href="mailto:$1">$1</a>');

          //Change "add your school here" to a link
          var replacePattern4 = /(add your school here)/gim;
          var replacedText = replacedText.replace(replacePattern4, '<a class="' + this.options.linkClass + '" href="add-school.html">$1</a>');

          return replacedText;
        }
    </script>
  </body>
</html>
