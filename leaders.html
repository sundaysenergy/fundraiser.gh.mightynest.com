<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Mighty Schools Fundraising Leaders</title>
    <link rel="stylesheet/less" href="components/bootstrap/less/bootstrap.less" media="all" />
    <link rel="stylesheet/less" href="css/style.less" media="all" />
    <script src="components/lessjs/less-1.3.3.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
    <script src="components/bootstrap/js/bootstrap-tooltip.js"></script>
    <script src="components/bootstrap/js/bootstrap-popover.js"></script>
    <script src="components/bootstrap/js/bootstrap-modal.js"></script>
    <script type="text/javascript">
      <!--//--><![CDATA[//><!--
      var _gaq = _gaq || [];_gaq.push(["_setAccount", "UA-7833382-2"]);_gaq.push(["_trackPageview"]);(function() {var ga = document.createElement("script");ga.type = "text/javascript";ga.async = true;ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga, s);})();
      //--><!]]>
    </script>
    <script src="http://www.datatables.net/release-datatables/media/js/jquery.dataTables.js"></script>
    <script type="text/javascript">
      (function ($) {
        $(function() {
          // Get school list
          var schools = {};
          $.ajax({
            dataType: 'json',
            url: 'http://mightynest.getsum.net/proxy/affiliate/list/json',
            async: false,
            success: function (data) {
              $.each(data, function (index, item) {
                schools[index] = item;
              });
            }
          });
          $('#leaders-table').dataTable({
            'bProcessing': true,
            'sAjaxSource': 'http://api.getsum.net/read/leaders?api_key=SSBMSUtFIFNFWCE&entity_source=mightynest&entity_type=user',
            "sAjaxDataProp": '',
            "bDestroy": true,
            'iDisplayLength': 25,
            'bAutoWidth': false,
            'aoColumns': [
              {'mData': 'entity_id'},
              {'mData': function (source, type, val) {
                if (source.entity_id.length == 5 && typeof schools[source.entity_id] != 'undefined') {
                  if (type == 'set') {
                    source.school_name = schools[source.entity_id];
                    return;
                  }
                  return typeof source.school_name != 'undefined' ? source.school_name : '';
                }
                return '';
              }},
              {'mData': 'values.sums.newsletter'},
              {'mData': 'values.sums.newsletter'},
              {'mData': 'values.transaction_totals.newsletter'},
              {'mData': 'values.transaction_totals.newsletter'}
            ]
          }).show();
        });
      })(jQuery);
    </script>
    <style type="text/css" title="currentStyle">
      @import "css/demo_page.css";
      @import "css/demo_table.css";
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Mightynest GetSum Transaction Generator</h2>

      <table cellpadding="0" cellspacing="0" border="0" class="display" id="leaders-table">
        <thead>
          <tr>
            <th>School ID</th>
            <th>School Name</th>
            <th>Newsletter Count</th>
            <th>Newsletter Sum</th>
            <th>Challenge Count</th>
            <th>Challenge Sum</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </body>
</html>